# CLAUDE.md - UI Directory

This directory contains a React Router v7 web application that provides a user interface for viewing MLflow experiments and runs generated by the Pokemon AI agent.

## Architecture

- **Framework**: React Router v7 with TypeScript
- **Styling**: TailwindCSS with @webtui/theme-catppuccin
- **Build Tool**: Vite
- **MLflow Integration**: Custom MLFlowClient wrapper around mlflow-js

## Key Components

### MLFlowClient (`app/MLFlowClient.ts`)
- Type-safe wrapper around the mlflow-js library
- Connects to MLflow tracking server at `http://localhost:8080`
- Provides methods for:
  - Getting experiments by name
  - Listing runs for an experiment
  - Retrieving run details and artifacts
  - Searching traces with filtering options

### Routes
- **Home (`routes/_index.tsx`)**: Lists runs from the 'open-llms-play-pokemon' experiment
- **Run Detail (`routes/run.$runId.tsx`)**: Shows detailed view of a specific run

### Components
- **ExperimentsNav (`components/ExperimentsNav.tsx`)**: Navigation component for browsing runs
- **BoxContainer (`components/BoxContainer.tsx`)**: Layout container component

## Development Commands

- **Start development server**: `pnpm dev` or `npm run dev`
- **Build for production**: `pnpm build` or `npm run build`
- **Type checking**: `pnpm typecheck` or `npm run typecheck`
- **Start production server**: `pnpm start` or `npm run start`

## Dependencies

### Core Dependencies
- `react` & `react-dom`: React 19
- `react-router`: React Router v7 for routing
- `mlflow-js`: MLflow JavaScript client
- `ky`: HTTP client for API requests
- `@webtui/css` & `@webtui/theme-catppuccin`: UI styling

### Development Dependencies
- `typescript`: TypeScript support
- `vite`: Build tool and dev server
- `tailwindcss`: CSS framework
- `@react-router/dev`: React Router development tools

## MLflow Integration

The UI connects to the MLflow tracking server that logs Pokemon AI agent runs. It displays:
- Experiment runs with status and timing information
- Run artifacts (screenshots, game state files)
- Trace data for debugging AI decision-making
- Metrics and parameters from each run

## Data Integration

The UI displays comprehensive data logged by the DSPy Pokemon agent (`main_dspy.py`):

### Logged Artifacts
- **Screenshots**: `screenshot_{step}.png` files logged every step with MLflow
- **Game State Data**: `game_state_step_{step}.json` files logged every 5 steps containing:
  - Basic game info (badges, party count, current map, battle status)
  - Player position and available movement directions
  - Detailed Pokemon party data (species, level, HP, status)
  - Inventory items and quantities
  - Raw memory data from the game emulator

### Metrics Tracked
- `badges`: Number of gym badges obtained
- `party_count`: Number of Pokemon in party
- `current_map`: Current map ID in the game
- `is_in_battle`: Boolean indicating if player is in battle

### UI Components for Data Visualization
- **MetricsDisplay**: Shows progress metrics and history table
- **ScreenshotGallery**: Grid view of screenshots with modal enlargement
- **GameDataViewer**: Interactive JSON data explorer with structured views
- **Enhanced ExperimentsNav**: Shows run status and key metrics in sidebar

## Development Standards

### Design
- The UI is a terminal UI (TUI) rendered to the web.

### CSS Units
- Use `ch` units for x-axis sizing (widths, horizontal padding/gaps)
- Use `lh` units for y-axis sizing (heights, vertical padding/gaps)
- Ensures consistent spacing relative to font metrics

### Code Quality
- Use `Number.parseInt()` instead of global `parseInt()`
- Provide meaningful keys for mapped elements (avoid array indexes)
- Use `htmlFor` and `id` attributes for form label accessibility
- Follow Biome linting rules for consistent code style

## Usage Notes

- Ensure MLflow server is running on `http://localhost:8080` before starting the UI
- The application expects the 'open-llms-play-pokemon' experiment to exist
- Screenshots and game state artifacts are displayed for debugging agent behavior
- Use `pnpm` for package management and development commands